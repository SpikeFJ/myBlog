
最近在看的**Java算法与机构**和**C语言程序设计**都提到了四则运算，所以整理下四则运算的算法步骤。


# 一. 背景知识
表达式求值一般有两种途径：

1. 转换成后缀表达式后，对后缀表达式求值
2. 直接求值

表达式如 `A+(B*C)` 有以下定义：
 `A`、`B`、`C`称之为操作数
 `+`、`-`、`*`、`/`、`(`、`)`称之为操作符

# 二. 转换成后缀表达式后求值

后缀表达式，又称逆波兰表示法。与此对应的有前缀表达式(很少使用)、中缀表达式。

其中的前缀、后缀、中缀的主题都是指运算符，我们正常接触到的都是中缀表达式，如`1+1`，其中`+`在两个数值中间。

所以`1+1`转换成后缀表达式就是`11+`,转换成前缀表达式就是`+11`,

**如果让计算机直接计算算术表达式(中缀表达式)，还是有点难度的，所我们分两步实现算法相对更容易**

1. 将中缀表达式转换为后缀表达式
2. 对后缀表达式求值

# 二. 算法描述

## **1. 转换后缀表达式**




步骤：维护一个栈存储 **运算符**，顺序读取字符串
1. 如果是`操作数`：直接输出
2. 如果是 `(` 直接入栈
3. 如果是 `)` 弹出栈中所有操作符直至遇到 `(` 退出
4. 如果是`操作符`(`opThis`)：
    1. 当栈为空时 `opThis` 直接入栈，返回
    2. 如果栈顶元素(`opTop`)是 `( `,将 `opThis` 入栈,返回
    3. 否则，比较`opTop`和`opThis`优先级
        1. `opTop` < `opThis`,即优先级大于栈中元素的优先级，将 `opThis` 入栈,返回
        2. `opTop` >= `opThis`，输出`opTop`，循环直至优先级不满足条件或`(`
5. 读取到字符结束时，弹出栈中所有

这里仅仅列出了转换的规则，至于规则是如何推导出来的，可以参考Java算法与机构一书,这个推导过程很重要。

## **2. 后缀表达式求值**

求值比较简单

形如：345+*612+/-

依次读取字符，
1. 如果是操作数，则入栈
2. 如果是操作符，则从栈中取出两个操作数，执行并将结果入栈



# 三. 直接求值

利用双栈，栈1存储操作数、栈2存储操作符


规则如下：
1. 依次解析表达式字符，如果是操作数则入栈1
2. 如果是操作符号，则操作符入栈2，入栈2前需要判断栈定元素是否优先级大于入栈操作符
    1. 如果栈顶元素优先级大，则需要运算(运算规则见3)，再入栈
    2. 如果栈顶元素优先级小，则直接入栈
3. 运算规则是：从栈1中连续两次弹出两个元素 `num1` , `num2` ，从栈2中弹出运算符 `op`，计算`num1 op num2`,结果入栈1

可以看到直接求值 和上述后缀表达式求值 本质是一样的。

**参考：**
[架构师之路-表达式求值](https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=2651962141&idx=1&sn=b089acccefc9e55098833cdc4e95d07f&chksm=bd2d0ec18a5a87d72cd0b72180eb3b433634fb1c2af0db0cd37687135a20bf839525976b8e71&scene=21#wechat_redirect)