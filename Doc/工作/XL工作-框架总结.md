框架主要目的应该包括 快速开发出功能原型，提高生产力

高工的框架，是一个大而全的框架，不仅仅包括了基础开发的框架搭建、还包括了业务的抽象、`UI`层的抽象接入

具体体现在 `web`和`winform`框架、任务调度框架、通讯框架、设备单元、电力规约驱动、`Control`和`View`等概念。

搭建这种框架，对抽象要求很高，需要很强的大局观。



对比下`java`的主流框架`Spring`

1. `Spring`是一个纯粹的技术框架，不包含任务业务逻辑
2. `Spring`更多的





# 一. `ORM`

`ORM`应该是系统走向成熟的第一步，也是评估一个单体应用是否方便的一个重要考量

这里有一个不断变化或者说是争论的观点：`ORM`要不要支持多数据源？

1. 早期大都是系统都是以改造或集成类项目为主，当从 一个系统迁移到另一个系统时，支持多数据源还是比较方便的。所以这个阶段大都数的`ORM`是支持多数据源的。

2. 之后大都数公司或团队，随着技术的发展，大都数不限于做集成改造类项目，大都数都具备了单独开发产品的能力，做产品时，对技术选择有了更大的话语权，这时发现更换数据源会涉及到系统的很多方便改造。所以都倾向于数据源保持不变，所以`ORM`的多数据源变成可选了。

3. 但是随着`devops`的发展，开发测试一体化又要求能够方便独立的搭建一个系统。测试，开发，演示的系统数据源都是不一样的。所以


XL这里的问题是：**虽然框架从底层支持了多数据源，但是并没有将该特性广泛应用。**

具体就是上面的第三点没有实现,理想的开发环境应该是支持数据源无缝切换的：

1. 不同类型数据库

    开发时使用`sqllite`/`H2`等内存数据库，正式部署时采用`mysql`/`oracle`

2. 同类型数据库，不同源

    测试时使用`xltest`，正式用`xl`

# 二. 任务调度

在系统发展演化的过程中，经历了两个阶段：
1. 以`winform`为主体的自动任务
2. 以控制台为主体的智能任务


1. 自动任务

作为系统的第一版任务，其实是有不少亮点的。

从架构的角度来看，甚至比后续的智能任务更加合理。


最核心的几个对象`TaskConfig`,`Task`,`TaskPeroid`

`Task`表示一个具体的任务基类，子类负责集成该类，实现`Run`方法，`Run`方法里面则是具体的业务逻辑。

`TaskConfig`则表示一个任务的配置信息，根据配置信息可以创建一个`Task`,设置/获取一些参数配置：运行周期，最大执行时间，重试次数

`TaskPeriod` 则表示任务运行周期基类，子类负责具体的任务调度时间。内置了分钟、小时、日、月、年。

**这里我学到的**：
1. 如何通过将一个定时任务中重要的几个概念抽象成上述3个对象，抽象是软件工程中非常重要的概念。
2. 任务运行时，如果暂停、停止，即如何中断一个正在运行中的任务

    大都数静态语言的线程机制都是基于协作式的，一个线程无法主动停止自己。

3. 如何通过模板模式搭建任务框架

    主要参考`Task`的`Start`实现

4. 如何实现周期性间隔任务

    本质上是采用`System.Threading.Timer`定时执行，并在每次执行后，生成下次执行的时间

# 三. 网络通讯

可以将协议解析拆分出来，独立成的那个服务应用，协议应用因为是无状态的，可以集群部署。

扩展可以通过不同端口对应不同协议来实现



通讯层只负责连接管理、鉴权等操作，

可以考虑net，因为应用层考虑`java`，主要是在应用及数据分析方面，需要考虑业务的扩展，`java`良好的生态可以迅速提供相应的解决方案

而通讯层和业务无关，向下至多和操作系统打交道，各种操作系统上的协议栈相对比较稳定

所以`java`和`net`差异不大，但是很多工控相关的业务，net使用起来更为强大。





2020-11-22 Update ：

框架的目的就是减少重复操作，提取公用操作，最终目的是减少人工成本

理想情况下，招聘刚入门的“菜鸟”也能顺利上手开发，这样的框架才是成功的的框架，

因为实实在在的帮助企业减少了人力成本，无需招聘工资高的老手就可以保证开发顺利进行



随着经济水平的不断上升，人力成本会逐渐成为企业运营中最大的成本，

当然以目前的AI、人工智能的发展，想逐步替换程序员还是 比较困难的，但是可以退而求其次，用入门的菜鸟代替人工成本较高的老手，也是另一种形式的【产业迁移】

当一款杀手锏的应用框架出现时，以上情况可能就会出现。