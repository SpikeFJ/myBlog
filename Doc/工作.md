
# 简述
项目主要功能是采集电力数据进行统计分析，电力数据通过主动采集和主动上报两个方式获取。

## 历史背景

该项目原本是用于供电局内部的采集系统，负责采集电力数据并分析统计。由于不同厂家的设备规约都不尽相同，所以框架一开始就采用了插件模式，每个规约、功能、界面都由一个个插件组成。

后来项目转型，目标对象变成了普通企业和环保局。一个项目由2B转为2C,变动还是很大的。底层架构的变动如下
*  web系统
    
    原本供电局内部一个系统负责档案录入，数据展示。拆分变为两个web：后台管理web仍旧负责档案录入，数据展示。另外添加前台展示界面，目的是提供更好的用户体验并针对不同用户提供不同的分析统计报表，与后台web职责分离，具备独立的权限分配。
* 前置机

    对于一般通用系统，可能不是很了解前置机这个概念。、在采集系统中，前置机负责两部分功能：1、负责终端设备的数据通讯 2、负责和后台用户的数据通讯

    前置机的由原来的Net程序变更为C++，变换语言与技术无关。

# 现状
目前我们整个平台分为前端、后台、大数据3个部门。

* 前端负责展示相关分析、统计、明细等报表给最终用户。
* 后台负责档案录入、原始数据展示；定时采集任务；前置机
* 大数据部门负责数据采集、上报处理

由于我负责后台项目，所以重点说下后台，后台分为web、前置机、任务调度及消息队列处理、websocket推送等。

* web

  问题主要是前后端没有分离

* 前置机
   
   没有方便的对外暴露相应的接口

* 任务调度
* 其他

# 问题
* 代码管理

    采用git管理，git在分支管理上可以满足现场提交了但不要发布，bug修改优先发布等需求

* 单元测试

    自动化测试的基础

* 数据表

    表结构的确定、主键的选择等<br>
    表名通过适当的前缀区分不同的模块<br>
    每张表都应该具有一些基本字段：创建时间、更新时间、操作人(和具体业务相关，忽略)、版本号<br>
    禁止物理删除，通过状态区分是否已删除。

* ORM与缓存

    禁止手工写sql，在分库分表、引入数据库中间件后，应该避免复杂sql；
    如果没有复杂sql，那简单sql应该全部可以通过orm工具生成，简单的sql配合多级缓存可以保证sql操作性能。

* 事务

    如果不需要事务，在基本档案上添加表示状态的字段，通过状态来识别档案的完整性。大量表报需要修改

* 服务、主备

    每个单独的启动项目都应该能作为服务运行，所以服务的安装应该是通用的，与具体项目无关的。
    同理、主备/多主也应该作为通过的组件调用。

* 前后端

    后端只提供具体的API，不管后台维护还是前台展示统一通过API操作、获取，

* 账号权限

    后台账号的权限应该聚焦于能看到那些操作对象/资源，至于对象/资源的属性不应该判断。<br><br>
    整个系统一套账号，丰富账号表。
    功能是合并成一个还是拆分多个？如果权限能细分到按钮级别。那还是合并的好。<br><br>
    但是如果只是api获取的话，操作资源就是API了

* 对象

    每一个对象需要有自己的配置和全局的配置

* 日志

    日志需要划分合理，是保存到数据库还是TXT文本；
    
* 文档自动生成。导出、导入


# 思考
* 如何判断软件好坏，我的理解: **逻辑正确>可读性>可扩展性**，在软件开发中比较重要的几点

    * 微服务
     广义上的微服务，就是模块的划分、管理，实际上还是分层、解耦、聚合
     * 消息队列
     解耦的利器，但是需要一开始就定义好消息交互的格式
     * 任务调度
     每个系统都应该具备定时执行的框架


* 关于框架  
平台区分技术框架和业务框架 技术框架与业务无关，提供基本权限、缓存、数据库操作、api调用以及与第三方框架集成的能力。<br><br>
业务框架则类似于领域建模，针对不同领域的业务提取公用逻辑、业务操作、流程。



